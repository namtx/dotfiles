function fpr() {
  ls ~/Projects/personio | fzfp | read project
  cd "/Users/namtx/Projects/personio/${project}"
}

function wsf() {
  ls ~/workspace | fzfp | read project
  cd "/Users/namtx/workspace/${project}"
}

function lsf() {

  ls | fzfp | read d
  cd "$(pwd)/$d"
}

function pr-checkout() {
  local pr_number
  pr_number=$(
    glab mr list |
    fzf |
    sed 's/^!\([0-9][0-9]*\).*/\1/'
  )

  glab mr checkout "$pr_number"
}

function conf() {
  case $1 in
    nvim)
      nvim ~/.config/nvim/init.vim
      ;;
    skhd)
      nvim ~/.config/skhd/skhdrc
      ;;
    kitty)
      nvim ~/.config/kitty/kitty.conf
      ;;
    yabai)
      nvim ~/.config/yabai/yabairc
      ;;
    zsh)
      nvim ~/.zshrc
      ;;
    *)
      nvim $1
      ;;
  esac
}

function source_nvm() {
  source $(brew --prefix nvm)/nvm.sh
}

# Connect to Airpods
function airpod() {
  airpod_address=$(blueutil --paired --format json | jq '.[] | select(.name | contains("Airpods")) | .address' | tr -d '"')

  blueutil --connect $airpod_address
}

function wtc() {
  git commit -m "$(curl -s http://whatthecommit.com/index.txt)"
}

# UTILS
function mkdircd() {
  mkdir -p ${1} && \
    cd -P -- ${1}
}

function telegram() {
  ps aux | rg -v rg | rg '/Applications/Telegram.app/Contents/MacOS/Telegram' | awk '{print $2}' | read telegram_pid
  if [[ $telegram_pid ]]; then
    kill $telegram_pid
  fi

  ls ~/telegram-accounts | fzfp | read telegram_account
  
  cp -R ~/telegram-accounts/${telegram_account}/. ~/Library/Application\ Support/Telegram\ Desktop
  /Applications/Telegram.app/Contents/MacOS/Telegram
}

function help() {
  case $1 in
    skhd)
      bat ~/.config/skhd/skhdrc
      ;;
  esac
}

# fuzzy search the commit message and show its changes
function gscf() { 
  git log --graph --oneline | fzfp | choose 1 | xargs git show
}

optimize_route() {
  local DOMAINS=(
    nexus.tools.personio-internal.de
    kibana-proxy.dev.personio-internal.de
    1DFEA83B4F053FE7310FCB95F2A8F4FE.yl4.eu-central-1.eks.amazonaws.com
    1A7EC99F8DD32DEC4B940DB52D56DBAC.yl4.eu-central-1.eks.amazonaws.com
    8256616ACE24D01C134B29E751249585.sk1.eu-central-1.eks.amazonaws.com
    admin.stage.personio-internal.de
    admin.dev.personio-internal.de
    gitlab.personio-internal.de
    rundeck.prod.personio-internal.de
    rundeck.stage.personio-internal.de
  )
  sudo route delete 128.0/1
  sudo route delete 0/1
  local vpn_gateway=172.27.248.1
  for domain in "${DOMAINS[@]}"
  do
    echo "Resolve domain: $domain"
    for ip in $(dig +short $domain)
    do
      echo "Add route for IP: $ip"
      sudo route add $ip $vpn_gateway
    done
    echo "Added route for domain: $domain"
    echo "-------"
  done
}

function gpod() {
  master_branch_exists=`git show-ref refs/heads/master`
  echo $master_branch_exists
  if [ -n "$master_branch_exists" ]; then
    git pull origin master
  else
    git pull origin main
  fi
}

# Personio
#
# Run test through Kubernetes pod
function kpunit() {
  local pod_name=$(kubectl get pods | fzf | awk '{print $1}')
  kubectl exec -it $pod_name -- vendor/phpunit/phpunit/phpunit $1
}
